# ubuntu 
FROM ubuntu:latest as builder

RUN apt-get update
RUN apt-get -y install openjdk-8-jdk-headless git
RUN apt-get -y install maven
RUN mkdir -p /home/librarycloud/ingest/cameldata 
RUN cd  /home/librarycloud/ && git clone https://github.com/harvard-library/librarycloud_ingest.git 
RUN cd /home/librarycloud/librarycloud_ingest && git checkout LTSCLOUD-1125
#ADD persistence.xml /home/librarycloud/librarycloud_ingest/src/main/resources/META-INF/persistence.xml
#RUN useradd --create-home lcadm
RUN useradd --uid 55003 -m lcadm
WORKDIR /home/librarycloud/librarycloud_ingest
COPY --chown=lcadm ./ .
RUN chown lcadm:lcadm -R /home/librarycloud/librarycloud_ingest

USER lcadm

RUN mvn -e -X clean install -Dmaven.test.skip=true 

# ubuntu 18 probably. 
FROM builder

#RUN mkdir -p /home/librarycloud/librarycloud_ingest
#COPY --from=builder /home/librarycloud/librarycloud_ingest /home/librarycloud/librarycloud_ingest
#RUN useradd --uid 55003 -m lcadm
#RUN chown lcadm:lcadm -R /home/librarycloud/librarycloud_ingest

USER lcadm

WORKDIR /home/librarycloud/librarycloud_ingest

#CMD mvn camel:run -q -Dmaven.test.skip=true > /dev/null

CMD sleep 1000000